## IO请求的两个阶段
1. 等待资源阶段（发起io请求）：或准备数据阶段。IO请求一般需要请求特殊的资源（如磁盘、RAM、文件），当资源被上一个使用者使用没有被释放时，IO请求就会被阻塞，直到能够使用这个资源。
2. 使用资源阶段（实际io操作）：或叫做数据从内核复制到用户进程缓冲区，是真正进行数据接收和发生。

## 两个阶段的区别
在<span style="color: #FF0000">等待数据阶段（发起IO请求）</span>，IO分为阻塞IO和非阻塞IO。（针对调用者是否是否愿意等待，即是否可以马上拿到结果）
- 阻塞IO： 资源不可用时，IO请求一直阻塞，直到反馈结果（有数据或超时）。如图
![]({{ site.baseurl }}/images/2019-07-30/block-1.png)

- 非阻塞IO：资源不可用时，IO请求离开返回，返回数据标识资源不可用
![]({{ site.baseurl }}/images/2019-07-30/none-block-1.png)

在<span style="color: #FF0000”>使用资源阶段</span>，IO分为同步IO和异步IO。（针对被调用者是否立马返回结果）

- IO复用
在请求数据前先调用select或poll，这2个系统调用都可以在内核准备好数据(网络数据到达内核)时告知用户进程，这个时候再调用recv一定是有数据的。所以阻塞阶段是在select或poll，接受数据阶段并没有阻塞。但是从内核到用户进程还是自己完成，所这也是同步的。可以理解为同步非阻塞。
![]({{ site.baseurl }}/images/2019-07-30/io-multi.png)

- 同步IO：应用阻塞在发送或接收数据的状态，直到数据成功传输或返回失败。
- 异步IO：应用发送或接收数据后立刻返回，数据写入OS缓存，由OS完成数据发送或接收，并返回成功或失败的信息给应用。即由系统完成IO操作再返回给我
如图：
![]({{ site.baseurl }}/images/2019-07-30/async-1.png)
## 例子

```text
如果你想吃一份宫保鸡丁盖饭： （两个阶段：1、准备饭的阶段；2、端上来）

同步阻塞：你到饭馆点餐，然后在那等着，还要一边喊：好了没啊！ 

同步非阻塞：在饭馆点完餐，就去遛狗了。不过溜一会儿，饭馆告诉我好了。如果好了，就回餐馆取餐（取餐过程是同步的）

异步阻塞：我不会一直询问，就一直等着饭做好。饭做好了，通知我亲自去拿。 （这里好像有点问题，既然是异步，应该是给我送到跟前才对。阻塞的阶段是在准备阶段，这个阶段可以理解为做饭阶段，反准备好了，但是一直没给我端上来，这时候我出去了，后来端出来了，应该给我送到跟前？这种描述合理，但是不太像事实。。。）

异步非阻塞：饭馆打电话说，我们知道您的位置，一会给你送过来（相当于os帮忙把数据从内核写到进程），安心遛狗就可以了。
```