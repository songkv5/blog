---
author: willis
date: 2020-03-28 11:40
---


### 一、定义
红黑树是基于二叉查找树。

### 二、相关概念

#### 1、满二叉树
**定义**：除最后一层无任何子节点外，每一层上的所有结点都有两个子结点的二叉树。

#### 2、完全二叉树
**定义**：若设二叉树的深度为h，除第 h 层外，其它各层 (1～h-1) 的结点数都达到最大个数，第 h 层所有的结点都连续集中在最左边，这就是完全二叉树。

#### 3、二叉查找树 （别名：二叉搜索树/有序二叉树/排序二叉树）

**性质**
1. 若任意节点的左子树不空，则左子树上所有节点的值均小于它的根节点的值；
2. 若任意节点的右子树不空，则右子树上所有节点的值均大于或等于它的根节点的值；
3. 任意节点的左、右子树也分别为二叉查找树。

查找、插入的时间复杂度：O(log₂n)，其中，n为节点数。
高度：log₂n。二叉树的查找难度取决于高度

#### 4、平衡二叉树（AVL树、平衡二叉查找树）
平衡二叉树及基于二叉查找树实现的。
**作者**：Adelse-Velskil 和 Landis

**性质**
1）可以是空树
2）假如不是空树，任何一个结点的**左子树**与**右子树**都是平衡二叉树，并且高度之差的绝对值不超过 1。

**平衡因子**：某节点的左子树与右子树的高度(深度)差即为该节点的平衡因子（BF,Balance Factor），平衡二叉树中不存在平衡因子大于 1 的节点。

**维持平衡的方法**：旋转（左旋与右旋）


### 三、红黑树

红黑树是基于二叉查找树实现、要区别于平衡二叉树。

#### 定义

**特性**
1. 每个节点不是红色就是黑色的
2. **根节点**总是**黑色**的
3. 每个叶子节点都是黑色的空节点（NIL节点）。
4. 如果节点是红色的，则它的子节点必须是黑色的（反之不一定）。即每个根节点到叶子节点的路径上不会有两个连续的红色节点，但是黑色节点是可以连续的。
5. 从根节点到叶节点或空子节点的每条路径，必须包含相同数目的黑色节点（即相同的黑色高度）。

#### 保证平衡的方法

1. 变色
2. 旋转（左旋与右旋）

![]({{ site.baseurl }}/images/2020-03-28/bt-left-rotate.gif)
![]({{ site.baseurl }}/images/2020-03-28/bt-right-rotate.gif)

**红黑树插入的节点都是红色的，因为这样代价最小：如果插入黑色，一定会破坏规则5，但是如果插入红色节点，只有50%的概率破坏规则4。**

#### 平衡插入
1. 查找并插入
2. 调整结构，保证满足红黑树状态
- 对节点进行重新着色
- 对树进行相关的旋转操作

##### 结构调整思路
1. **父亲节点和叔叔节点都是红色**，调整如图
![]({{ site.baseurl }}/images/2020-03-28/color-change-1.png)

> N为插入节点，如果父亲节点（P）和父亲的兄弟节点（叔叔节点U）都是红色，则爷爷节点一定是黑色（规则4）。
> 由于红色节点的孩子不能使红色，此时要把父亲节点和叔叔节点染成黑色，爷爷节点G染成红色。这样子树两边路径上的黑色节点数是一致的，也可以满足规则5。
>
> 但是，爷爷节点G染成红色后，G的父亲节点如果是红色，又违反了规则4...
> 这个问题，只要把爷爷节点G当做新的节点，在进行调整，循环往复，**直到父节点不是红的**，就可以了。
>

2. **父节点为红色，叔叔节点为黑色**，调整如图

![]({{ site.baseurl }}/images/2020-03-28/rotate-1.png)

N为插入节点，这时父亲节点 P 是红色，爷爷节点 G 一定是黑色。

*红色节点的孩子不能是红色，但是直接把父亲节点 P 涂成黑色也不行，这条路径多了个黑色节点。怎么办呢？*

>答：将爷爷节点G向右旋转。
此时，P 变成了这个子树的根节点，G 变成了 P 的右子树。
>右旋后 G 跑到了右子树上，这时把 P 变成黑的，多了一个黑节点，再把 G 变成红的，就平衡了！

>上图中N是P的左子节点，如果是右子节点，则需要多进行一次左旋（如下图），然后再按照上面的操作进行一遍。

![]({{ site.baseurl }}/images/2020-03-28/rotate-2.png)

#### 红黑树的平衡删除
1. 二叉查找树的删除
2. 接口调整

##### 二叉查找树的删除
1. 要删除的节点正好是叶子节点，直接删除就 OK 了；
2. 只有左孩子或者右孩子，直接把这个孩子上移放到要删除的位置就好了；
3. 有两个孩子，就需要选一个合适的孩子节点作为新的根节点，该节点称为 继承节点。

#### 删除后的结构调整
如果当前待删除节点是红色的，它被删除之后对当前树的特性不会造成任何破坏影响。
而如果被删除的节点是黑色的，这就需要进行进一步的调整来保证后续的树结构满足要求。

因此，我们只需要考虑删除的节点是黑色节点的情况

#未完待续

----
参考文章：

>[面试旧敌之红黑树（直白介绍深入理解）](https://juejin.im/entry/58371f13a22b9d006882902d#%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E5%B9%B3%E8%A1%A1%E6%8F%92%E5%85%A5)
>[什么是红黑树](https://zhuanlan.zhihu.com/p/31805309)
>[【数据结构和算法05】 红-黑树](https://blog.csdn.net/eson_15/article/details/51144079)




