---
author: willis
date: 2020-05-23 23:34
---

# Zookeeper与ZAB协议

## 一、Zookeeper
### 1、定位
>Zookeeper是一个开放源代码的分布式协调服务，雅虎创建，是google chubby的开源实现。Zookeeper的设计目标是将那些复杂且容易出错的分布式一致性服务封装起来，构成一个可靠的原语集，兵役一些列简单易用的接口提供给用户使用。
>Zookeeper是一个典型的分布式数据一致性的解决方案，分布式应用程序可以基于它实现诸如数据发布订阅，负载均衡、命名服务、分布式协调/通知、集群管理、Master选举、分布式锁和分布式队列等功能。

### 2、一致性
- 顺序一致性
> 从同一个客户端发起的事务请求，最终将会严格按照其他发起顺序被应用到Zookeeper中

- 原子性
> 所有事物请求的处理结果在整个集群中所有机器上的应用情况是一致的，也就是说，要么整个集群所有机器都成功应用了某一个事物，要么都没有应用。

- 单一视图（Single System Image）
> 无论客户端连接的是哪个Zookeeper服务器，其看到的服务器数据模型都是一致的

- 可靠性
> 一旦服务端成功的应用了一个事务，并完成对客户端的响应，那么钙食物所引起的服务端状态变更将会一致保留下来，除非有另一个事务又对其进行了变更。

- 实时性
>一旦一个事务被成功应用，那么客户端能够立刻从服务端上读取到这个事务变更后的最新数据状态。但是，Zookeeper仅仅保证在【一定的时间内】，客户端最终一定能够从服务端上读取到最新的数据状态

### 3、zk的集群模式
![zk集群]({{ site.baseurl }}/images/2020-05-23/zk-group.png)

#### 3.1、集群角色
在zk中，没有沿用传统的Master/Slave概念，而是引入了Leader、Flollower和Observer三种角色。集群中的所有机器通过一个Leader选举过程来选定一台被称为leader的机器，支持读与写；follower和observer都能提供读服务，唯一区别在于observer机器不参与leader选举，也不参与过半策略。

#### 3.2、会话
即session。在zk中，通过tcp长链接维持会话，客户端通过心跳检测与服务端保持有效的会话。

#### 3.3、结点
1. 构成集群的机器，成为机器结点
2. 数据模型中的数据单元，成为数据结点（Znode）。
> zk将所有数据存储在内存中，数据模型是一棵树（Znode Tree），由斜杠/进行分割的路径，就是一个Znode，例如/foo/path1。每个znode都会保存自己的数据内容，同时还会保存一些里属性信息。
> 在zk中，znode可以分为持久结点和临时结点。持久结点一旦创建，除非主动移除znode，否则将一直存在于zk上；临时结点的生命周期和客户端会话（session）绑定，会话失效意味着临时结点会被移除。

#### 3.4、ACL（Acess control lists）权限控制，zk定义的权限如下
- CREATE：创建子节点
- READ：获取节点数据和子节点列表
- WRITE：更新节点数据
- DELETE：删除子节点
- ADMIN：设置结点ACL

## 二、ZAB